{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/SIPPesantren/5c545958-637b-416e-a3eb-5dcf940bcaca/src/lib/auth.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\r\nimport { redirect } from \"next/navigation\";\r\n\r\nexport type UserRole = \"ADMIN\" | \"USTADZ\" | \"ORANG_TUA\";\r\n\r\ninterface UserSession {\r\n  id: number;\r\n  email: string;\r\n  role: UserRole;\r\n  name: string;\r\n}\r\n\r\n// Mock user data for demo purposes\r\nconst mockUsers: Record<string, UserSession> = {\r\n  \"admin@pesantren.com\": {\r\n    id: 1,\r\n    email: \"admin@pesantren.com\",\r\n    role: \"ADMIN\",\r\n    name: \"Pengelola\",\r\n  },\r\n  \"ustadz@pesantren.com\": {\r\n    id: 2,\r\n    email: \"ustadz@pesantren.com\",\r\n    role: \"USTADZ\",\r\n    name: \"Ustadz Ahmad\",\r\n  },\r\n  \"ortu@pesantren.com\": {\r\n    id: 3,\r\n    email: \"ortu@pesantren.com\",\r\n    role: \"ORANG_TUA\",\r\n    name: \"Bapak/Ibu Orang Tua\",\r\n  },\r\n};\r\n\r\nexport async function getSession(): Promise<UserSession | null> {\r\n  const cookieStore = await cookies();\r\n  const sessionCookie = cookieStore.get(\"session\");\r\n\r\n  if (!sessionCookie?.value) {\r\n    return null;\r\n  }\r\n\r\n  // For demo, decode base64 and parse (in production, use proper JWT)\r\n  try {\r\n    const decoded = JSON.parse(atob(sessionCookie.value));\r\n    return decoded as UserSession;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function requireAuth(allowedRoles?: UserRole[]): Promise<UserSession> {\r\n  const session = await getSession();\r\n\r\n  if (!session) {\r\n    redirect(\"/login\");\r\n  }\r\n\r\n  if (allowedRoles && !allowedRoles.includes(session.role)) {\r\n    redirect(\"/unauthorized\");\r\n  }\r\n\r\n  return session;\r\n}\r\n\r\nexport async function login(email: string, password: string): Promise<{ success: boolean; error?: string }> {\r\n  // For demo, accept any password\r\n  const user = mockUsers[email];\r\n\r\n  if (!user) {\r\n    return { success: false, error: \"Email tidak ditemukan\" };\r\n  }\r\n\r\n  const cookieStore = await cookies();\r\n  cookieStore.set(\"session\", btoa(JSON.stringify(user)), {\r\n    httpOnly: true,\r\n    secure: process.env.NODE_ENV === \"production\",\r\n    sameSite: \"lax\",\r\n    maxAge: 60 * 60 * 24 * 7, // 7 days\r\n    path: \"/\",\r\n  });\r\n\r\n  return { success: true };\r\n}\r\n\r\nexport async function logout() {\r\n  const cookieStore = await cookies();\r\n  cookieStore.delete(\"session\");\r\n  redirect(\"/login\");\r\n}\r\n\r\nexport function getRoleRedirectUrl(role: UserRole): string {\r\n  switch (role) {\r\n    case \"ADMIN\":\r\n      return \"/admin\";\r\n    case \"USTADZ\":\r\n      return \"/ustadz\";\r\n    case \"ORANG_TUA\":\r\n      return \"/orang-tua\";\r\n    default:\r\n      return \"/login\";\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AAAA;;;AAWA,mCAAmC;AACnC,MAAM,YAAyC;IAC7C,uBAAuB;QACrB,IAAI;QACJ,OAAO;QACP,MAAM;QACN,MAAM;IACR;IACA,wBAAwB;QACtB,IAAI;QACJ,OAAO;QACP,MAAM;QACN,MAAM;IACR;IACA,sBAAsB;QACpB,IAAI;QACJ,OAAO;QACP,MAAM;QACN,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,gBAAgB,YAAY,GAAG,CAAC;IAEtC,IAAI,CAAC,eAAe,OAAO;QACzB,OAAO;IACT;IAEA,oEAAoE;IACpE,IAAI;QACF,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,cAAc,KAAK;QACnD,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,YAAY,YAAyB;IACzD,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS;QACZ,IAAA,iMAAQ,EAAC;IACX;IAEA,IAAI,gBAAgB,CAAC,aAAa,QAAQ,CAAC,QAAQ,IAAI,GAAG;QACxD,IAAA,iMAAQ,EAAC;IACX;IAEA,OAAO;AACT;AAEO,eAAe,MAAM,KAAa,EAAE,QAAgB;IACzD,gCAAgC;IAChC,MAAM,OAAO,SAAS,CAAC,MAAM;IAE7B,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,SAAS;YAAO,OAAO;QAAwB;IAC1D;IAEA,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,WAAW,KAAK,KAAK,SAAS,CAAC,QAAQ;QACrD,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;IAEA,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;IACnB,IAAA,iMAAQ,EAAC;AACX;AAEO,SAAS,mBAAmB,IAAc;IAC/C,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/SIPPesantren/5c545958-637b-416e-a3eb-5dcf940bcaca/src/components/layout/DashboardLayout.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DashboardLayout = registerClientReference(\n    function() { throw new Error(\"Attempted to call DashboardLayout() from the server but DashboardLayout is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/layout/DashboardLayout.tsx <module evaluation>\",\n    \"DashboardLayout\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,kBAAkB,IAAA,wQAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,2EACA","ignoreList":[0]}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/SIPPesantren/5c545958-637b-416e-a3eb-5dcf940bcaca/src/components/layout/DashboardLayout.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DashboardLayout = registerClientReference(\n    function() { throw new Error(\"Attempted to call DashboardLayout() from the server but DashboardLayout is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/layout/DashboardLayout.tsx\",\n    \"DashboardLayout\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,kBAAkB,IAAA,wQAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,uDACA","ignoreList":[0]}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/SIPPesantren/5c545958-637b-416e-a3eb-5dcf940bcaca/src/app/ustadz/absensi/AbsensiClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/ustadz/absensi/AbsensiClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/ustadz/absensi/AbsensiClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA4S,GACzU,0EACA","ignoreList":[0]}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/SIPPesantren/5c545958-637b-416e-a3eb-5dcf940bcaca/src/app/ustadz/absensi/AbsensiClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/ustadz/absensi/AbsensiClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/ustadz/absensi/AbsensiClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAwR,GACrT,sDACA","ignoreList":[0]}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/SIPPesantren/5c545958-637b-416e-a3eb-5dcf940bcaca/src/app/ustadz/absensi/page.tsx"],"sourcesContent":["import { requireAuth } from \"@/lib/auth\";\r\nimport { db } from \"@/db\";\r\nimport { DashboardLayout } from \"@/components/layout/DashboardLayout\";\r\nimport AbsensiClient from \"./AbsensiClient\";\r\n\r\nexport default async function UstadzAbsensiPage() {\r\n  const session = await requireAuth([\"USTADZ\"]);\r\n\r\n  // Fetch data from Google Sheets\r\n  const santris = await db.select('santris');\r\n  const absensis = await db.select('absensis');\r\n\r\n  return (\r\n    <DashboardLayout\r\n      role=\"USTADZ\"\r\n      userName={session.name}\r\n      userId={String(session.id)}\r\n      pageTitle=\"Absensi Santri\"\r\n    >\r\n      <AbsensiClient \r\n        santris={santris} \r\n        absensis={absensis} \r\n        ustadzId={session.id}\r\n      />\r\n    </DashboardLayout>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,iIAAW,EAAC;QAAC;KAAS;IAE5C,gCAAgC;IAChC,MAAM,UAAU,MAAM,wHAAE,CAAC,MAAM,CAAC;IAChC,MAAM,WAAW,MAAM,wHAAE,CAAC,MAAM,CAAC;IAEjC,qBACE,8OAAC,kKAAe;QACd,MAAK;QACL,UAAU,QAAQ,IAAI;QACtB,QAAQ,OAAO,QAAQ,EAAE;QACzB,WAAU;kBAEV,cAAA,8OAAC,4JAAa;YACZ,SAAS;YACT,UAAU;YACV,UAAU,QAAQ,EAAE;;;;;;;;;;;AAI5B"}}]
}